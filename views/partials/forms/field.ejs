<%
  const fieldName = (typeof name !== 'undefined' && name) ? name : '';
  const fieldId = (typeof id === 'undefined' || id === null) ? fieldName : id;
  const fieldLabel = (typeof label !== 'undefined' && label) ? label : fieldName;
  const fieldType = (typeof type !== 'undefined' && type) ? type : 'text';
  const fieldAs = (typeof as !== 'undefined' && as)
    ? as
    : (fieldType === 'textarea' || fieldType === 'select' || fieldType === 'checkbox' ? fieldType : 'input');
  const fieldValue = (typeof value !== 'undefined' && value !== null) ? value : '';
  const fieldPlaceholder = (typeof placeholder !== 'undefined' && placeholder !== null) ? placeholder : '';
  const fieldAriaLabel = (typeof ariaLabel !== 'undefined' && ariaLabel) ? ariaLabel : fieldLabel;
  const fieldRows = (typeof rows !== 'undefined' && rows !== null) ? rows : 3;
  const fieldOptions = (typeof options !== 'undefined' && Array.isArray(options)) ? options : [];
  const isRequired = (typeof required !== 'undefined') ? Boolean(required) : false;
  const isChecked = (typeof checked !== 'undefined') ? Boolean(checked) : false;
  const isMultiple = (typeof multiple !== 'undefined') ? Boolean(multiple) : false;
  const isDisabled = (typeof disabled !== 'undefined') ? Boolean(disabled) : false;
  const isReadonly = (typeof readonly !== 'undefined') ? Boolean(readonly) : false;
  const styleVariant = (typeof variant !== 'undefined' && variant) ? variant : 'plain';

  let fieldError = null;
  if (typeof error !== 'undefined' && error) {
    fieldError = error;
  } else if (typeof errorFor === 'function') {
    fieldError = errorFor(fieldName);
  } else if (typeof errors !== 'undefined' && errors && errors[fieldName]) {
    fieldError = errors[fieldName];
  }

  const wrapperClassName = (typeof wrapperClass !== 'undefined' && wrapperClass)
    ? wrapperClass
    : (styleVariant === 'bootstrap' ? 'col-12' : 'form-field');
  const labelClassName = (typeof labelClass !== 'undefined' && labelClass)
    ? labelClass
    : (styleVariant === 'bootstrap' ? 'form-label' : '');
  const plainControlClassName = (typeof controlClass !== 'undefined' && controlClass) ? controlClass : '';

  const bootstrapControlClass = (function () {
    const base = fieldAs === 'select' ? 'form-select' : (fieldAs === 'checkbox' ? 'form-check-input' : 'form-control');
    const extra = (typeof controlClass !== 'undefined' && controlClass) ? ` ${controlClass}` : '';
    const invalid = fieldError ? ' is-invalid' : '';
    return `${base}${extra}${invalid}`;
  })();
%>

<% if (styleVariant === 'bootstrap') { %>
  <% if (fieldAs === 'checkbox') { %>
    <div class="<%= wrapperClassName %>">
      <div class="form-check">
        <input
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          type="checkbox"
          value="<%= (typeof checkboxValue !== 'undefined') ? checkboxValue : 'true' %>"
          class="<%= bootstrapControlClass %>"
          <%= isChecked ? 'checked' : '' %>
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        />
        <label class="form-check-label" for="<%= fieldId %>"><%= fieldLabel %></label>
        <% if (fieldError) { %>
          <div class="invalid-feedback"><%= fieldError %></div>
        <% } %>
      </div>
    </div>
  <% } else { %>
    <div class="<%= wrapperClassName %>">
      <label for="<%= fieldId %>" class="<%= labelClassName %>">
        <%= fieldLabel %>
        <% if (isRequired) { %><span aria-hidden="true">*</span><% } %>
      </label>

      <% if (fieldAs === 'textarea') { %>
        <textarea
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          class="<%= bootstrapControlClass %>"
          rows="<%= fieldRows %>"
          placeholder="<%= fieldPlaceholder %>"
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        ><%= fieldValue %></textarea>
      <% } else if (fieldAs === 'select') { %>
        <select
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          class="<%= bootstrapControlClass %>"
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        >
          <% if (fieldPlaceholder) { %>
            <option value=""><%= fieldPlaceholder %></option>
          <% } %>
          <% fieldOptions.forEach(function (option) { %>
            <% const optionValue = (option && Object.prototype.hasOwnProperty.call(option, 'value')) ? option.value : ''; %>
            <% const optionLabel = (option && Object.prototype.hasOwnProperty.call(option, 'label')) ? option.label : optionValue; %>
            <% const optionDisabled = Boolean(option && option.disabled); %>
            <option value="<%= optionValue %>" <%= String(fieldValue) === String(optionValue) ? 'selected' : '' %> <%= optionDisabled ? 'disabled' : '' %>><%= optionLabel %></option>
          <% }) %>
        </select>
      <% } else { %>
        <input
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          type="<%= fieldType %>"
          <% if (fieldType !== 'file') { %>value="<%= fieldValue %>"<% } %>
          class="<%= bootstrapControlClass %>"
          placeholder="<%= fieldPlaceholder %>"
          <% if (typeof accept !== 'undefined' && accept) { %>accept="<%= accept %>"<% } %>
          <%= isMultiple ? 'multiple' : '' %>
          <% if (typeof min !== 'undefined' && min !== null && min !== '') { %>min="<%= min %>"<% } %>
          <% if (typeof max !== 'undefined' && max !== null && max !== '') { %>max="<%= max %>"<% } %>
          <% if (typeof step !== 'undefined' && step !== null && step !== '') { %>step="<%= step %>"<% } %>
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        />
      <% } %>

      <% if (fieldError) { %>
        <div class="invalid-feedback"><%= fieldError %></div>
      <% } %>
      <% if (typeof helpText !== 'undefined' && helpText) { %>
        <div class="form-text"><%= helpText %></div>
      <% } %>
    </div>
  <% } %>
<% } else { %>
  <% if (fieldAs === 'checkbox') { %>
    <div class="<%= wrapperClassName %>">
      <label for="<%= fieldId %>">
        <input id="<%= fieldId %>" name="<%= fieldName %>" type="checkbox" value="<%= (typeof checkboxValue !== 'undefined') ? checkboxValue : 'true' %>" <%= isChecked ? 'checked' : '' %> <%= isRequired ? 'required' : '' %> <%= isDisabled ? 'disabled' : '' %> <%= isReadonly ? 'readonly' : '' %> />
        <span><%= fieldLabel %></span>
      </label>
      <% if (fieldError) { %>
        <div class="field-error" role="alert"><%= fieldError %></div>
      <% } %>
    </div>
  <% } else { %>
    <div class="<%= wrapperClassName %>">
      <label for="<%= fieldId %>" class="<%= labelClassName %>">
        <%= fieldLabel %>
        <% if (isRequired) { %><span aria-hidden="true">*</span><% } %>
      </label>

      <% if (fieldAs === 'textarea') { %>
        <textarea
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          class="<%= plainControlClassName %>"
          rows="<%= fieldRows %>"
          placeholder="<%= fieldPlaceholder %>"
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        ><%= fieldValue %></textarea>
      <% } else if (fieldAs === 'select') { %>
        <select id="<%= fieldId %>" name="<%= fieldName %>" class="<%= plainControlClassName %>" <%= isRequired ? 'required' : '' %> <%= isDisabled ? 'disabled' : '' %> <%= isReadonly ? 'readonly' : '' %> aria-label="<%= fieldAriaLabel %>">
          <% if (fieldPlaceholder) { %>
            <option value=""><%= fieldPlaceholder %></option>
          <% } %>
          <% fieldOptions.forEach(function (option) { %>
            <% const optionValue = (option && Object.prototype.hasOwnProperty.call(option, 'value')) ? option.value : ''; %>
            <% const optionLabel = (option && Object.prototype.hasOwnProperty.call(option, 'label')) ? option.label : optionValue; %>
            <% const optionDisabled = Boolean(option && option.disabled); %>
            <option value="<%= optionValue %>" <%= String(fieldValue) === String(optionValue) ? 'selected' : '' %> <%= optionDisabled ? 'disabled' : '' %>><%= optionLabel %></option>
          <% }) %>
        </select>
      <% } else { %>
        <input
          id="<%= fieldId %>"
          name="<%= fieldName %>"
          type="<%= fieldType %>"
          <% if (fieldType !== 'file') { %>value="<%= fieldValue %>"<% } %>
          class="<%= plainControlClassName %>"
          placeholder="<%= fieldPlaceholder %>"
          <% if (typeof accept !== 'undefined' && accept) { %>accept="<%= accept %>"<% } %>
          <%= isMultiple ? 'multiple' : '' %>
          <% if (typeof min !== 'undefined' && min !== null && min !== '') { %>min="<%= min %>"<% } %>
          <% if (typeof max !== 'undefined' && max !== null && max !== '') { %>max="<%= max %>"<% } %>
          <% if (typeof step !== 'undefined' && step !== null && step !== '') { %>step="<%= step %>"<% } %>
          <%= isRequired ? 'required' : '' %>
          <%= isDisabled ? 'disabled' : '' %>
          <%= isReadonly ? 'readonly' : '' %>
          aria-label="<%= fieldAriaLabel %>"
        />
      <% } %>

      <% if (fieldError) { %>
        <div class="field-error" role="alert"><%= fieldError %></div>
      <% } %>
    </div>
  <% } %>
<% } %>
