<% const sidebarCan = typeof permissionHelper !== 'undefined' && permissionHelper ? permissionHelper.can : function () { return false; }; %>
<% const sidebarCanAny = typeof permissionHelper !== 'undefined' && permissionHelper ? permissionHelper.canAny : function () { return false; }; %>
<% const tr = (typeof t === 'function') ? t : function (key, fallback) { return fallback || key; }; %>
<div class="offcanvas offcanvas-start admin-drawer" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="adminSidebar" aria-labelledby="adminSidebarLabel">
  <div class="admin-drawer-header">
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-dismiss="offcanvas" aria-label="<%= tr('admin.sidebar.close', 'Admin-Panel schließen') %>">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <h2 class="admin-drawer-title h6" id="adminSidebarLabel"><%= tr('admin.sidebar.title', 'Admin-Panel') %></h2>
  </div>
  <div class="admin-drawer-content">
    <nav class="nav flex-column">

    <!-- Manage LendingLocation -->
    <% if (sidebarCanAny(['openinghours.manage', 'lendinglocations.manage', 'system.admin'])) { %>
      <div class="mb-3">
        <div class="text-uppercase small text-muted fw-semibold mt-2"><%= tr('admin.sidebar.lending_management', 'Ausleih Verwaltung') %></div>
        <% if (activeLendingLocation && (sidebarCan('lendinglocations.manage') || sidebarCan('system.admin'))) { %>
          <a class="nav-link" href="/system/lending-locations/<%= activeLendingLocation.id %>/edit"><%= tr('admin.sidebar.settings', 'Einstellungen') %></a>
        <% } else if (sidebarCan('system.admin')) { %>
          <a class="nav-link" href="/system/lending-locations"><%= tr('admin.sidebar.settings', 'Einstellungen') %></a>
        <% } %>
        <% if (sidebarCan('openinghours.manage')) { %>
          <a class="nav-link" href="/admin/opening-hours"><%= tr('admin.sidebar.opening_hours', 'Öffnungszeiten') %></a>
        <% } %>
        <% if (sidebarCan('lendinglocations.manage') || sidebarCan('system.admin')) { %>
          <a class="nav-link" href="/admin/lending-user-roles"><%= tr('admin.sidebar.lending_roles', 'Benutzerrolle (Ausleihe)') %></a>
        <% } %>
      </div>
    <% } %>

      <!-- Manage Assets -->
    <% if (sidebarCan('inventory.manage')) { %>
      <div class="mb-3">
      <div class="text-uppercase small text-muted fw-semibold mt-2"><%= tr('admin.sidebar.inventory_management', 'Inventar Verwaltung') %></div>
      <a class="nav-link" href="/admin/storage-locations"><%= tr('admin.sidebar.storage_locations', 'Lagerorte') %></a>
      <a class="nav-link" href="/admin/categories"><%= tr('admin.sidebar.categories', 'Kategorien') %></a>
      <a class="nav-link" href="/admin/manufacturers"><%= tr('admin.sidebar.manufacturers', 'Hersteller') %></a>
      <a class="nav-link" href="/admin/asset-models"><%= tr('admin.sidebar.asset_models', 'Asset Models') %></a>
      <a class="nav-link" href="/admin/assets"><%= tr('admin.sidebar.assets', 'Assets') %></a>
      <hr class="my-0">
      <a class="nav-link" href="/admin/assets/import"><%= tr('admin.sidebar.import', 'Import') %></a>
      <a class="nav-link" href="/admin/exports"><%= tr('admin.sidebar.export', 'Export') %></a>
      <a class="nav-link" href="/admin/reports"><%= tr('admin.sidebar.print_pdf', 'Druck & PDF') %></a>
      </div>
    <% } %>

    <!-- Manage Loans -->
    <% if (sidebarCan('loan.manage')) { %>
      <div class="mb-3">
      <div class="text-uppercase small text-muted fw-semibold mt-2"><%= tr('admin.sidebar.loans', 'Ausleihe') %></div>
      <a class="nav-link" href="/admin/loans/new"><%= tr('admin.sidebar.new_loan', 'Neue Ausleihe') %></a>
      <a class="nav-link" href="/admin/loans"><%= tr('admin.sidebar.active_loans', 'Aktive Ausleihen') %></a>
      <a class="nav-link" href="/admin/reservations"><%= tr('admin.sidebar.open_reservations', 'Offene Reservierungen') %></a>
      <a class="nav-link" href="/admin/loans?status=overdue"><%= tr('admin.sidebar.overdue_returns', 'Überfällige Rückgaben') %></a>
      </div>
    <% } %>

    <!-- Manage Users and Permissions -->
    <% if (sidebarCan('system.admin')) { %>
      <div class="mb-3">
      <div class="text-uppercase small text-muted fw-semibold mt-4"><%= tr('admin.sidebar.user_management', 'Benutzerverwaltung') %></div>
      <% if (sidebarCan('users.manage')) { %>
        <a class="nav-link" href="/admin/users"><%= tr('admin.sidebar.users', 'Benutzer') %></a>
      <% } %>
      <% if (sidebarCan('roles.manage')) { %>
        <a class="nav-link" href="/admin/roles"><%= tr('admin.sidebar.roles', 'Rollen') %></a>
      <% } %>
      <% if (sidebarCan('permissions.manage')) { %>
        <a class="nav-link" href="/admin/permissions"><%= tr('admin.sidebar.permissions', 'Berechtigungen') %></a>
      <% } %>
      </div>
    <% } %>

    <!-- System Settings -->
    <% if (sidebarCan('system.admin')) { %>
      <div class="mb-3">
      <div class="text-uppercase small text-muted fw-semibold mt-4"><%= tr('admin.sidebar.system', 'System') %></div>
      <% if (sidebarCan('system.admin')) { %>
        <a class="nav-link" href="/system/lending-locations"><%= tr('admin.sidebar.lending_locations', 'Ausleihstellen') %></a>
      <% } %>
      <% if (sidebarCan('customfields.manage')) { %>
        <a class="nav-link" href="/admin/custom-fields"><%= tr('admin.sidebar.custom_fields', 'Custom Fields') %></a>
      <% } %>
      <% if (sidebarCan('system.auth.manage')) { %>
        <a class="nav-link" href="/system/auth-config"><%= tr('admin.sidebar.auth_config', 'Auth Config') %></a>
      <% } %>
      <% if (sidebarCan('system.admin')) { %>
        <a class="nav-link" href="/system/ui-texts"><%= tr('admin.sidebar.ui_texts', 'UI Texte') %></a>
        <a class="nav-link" href="/system/mail"><%= tr('admin.sidebar.mail', 'Mail-System') %></a>
        <a class="nav-link" href="/system/privacy"><%= tr('admin.sidebar.privacy', 'Datenschutz') %></a>
      <% } %>
      <% if (sidebarCan('audit.view') || sidebarCan('system.admin')) { %>
        <a class="nav-link" href="/system/audit-log"><%= tr('admin.sidebar.audit_log', 'Audit Log') %></a>
      <% } %>
      </div>
    <% } %>
    </nav>
  </div>
</div>
