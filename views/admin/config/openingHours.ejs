<% pageTitle = 'Öffnungszeiten' %>
<%
  const toHm = (typeof formatTimeHHMM === 'function')
    ? formatTimeHHMM
    : function (value) {
        if (!value) return '';
        const match = String(value).match(/^(\d{1,2}):(\d{2})/);
        if (!match) return String(value);
        return String(Number(match[1])).padStart(2, '0') + ':' + match[2];
      };
%>
<section class="admin config">
  <h1>Öffnungszeiten</h1>
  <h2>Regulär</h2>
  <% if (Array.isArray(hours) && hours.length) { %>
    <table>
      <thead>
        <tr>
          <th>Tag</th>
          <th>Von</th>
          <th>Bis</th>
          <th>Abholung</th>
          <th>Rückgabe</th>
          <th>Geschlossen</th>
        </tr>
      </thead>
      <tbody>
        <% hours.forEach(function(h) { %>
          <tr>
            <td><%= h.dayOfWeek %></td>
            <td><%= toHm(h.openTime || '-') %></td>
            <td><%= toHm(h.closeTime || '-') %></td>
            <td><%= toHm(h.pickupOpenTime || h.openTime || '-') %> - <%= toHm(h.pickupCloseTime || h.closeTime || '-') %></td>
            <td><%= toHm(h.returnOpenTime || h.openTime || '-') %> - <%= toHm(h.returnCloseTime || h.closeTime || '-') %></td>
            <td><%= h.isClosed ? 'Ja' : 'Nein' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p class="empty">Keine regulären Öffnungszeiten.</p>
  <% } %>

  <h2>Ausnahmen</h2>
  <% if (Array.isArray(exceptions) && exceptions.length) { %>
    <table>
      <thead>
        <tr>
          <th>Datum</th>
          <th>Von</th>
          <th>Bis</th>
          <th>Abholung</th>
          <th>Rückgabe</th>
          <th>Geschlossen</th>
        </tr>
      </thead>
      <tbody>
        <% exceptions.forEach(function(e) { %>
          <tr>
            <td><%= e.date %></td>
            <td><%= toHm(e.openTime || '-') %></td>
            <td><%= toHm(e.closeTime || '-') %></td>
            <td><%= toHm(e.pickupOpenTime || e.openTime || '-') %> - <%= toHm(e.pickupCloseTime || e.closeTime || '-') %></td>
            <td><%= toHm(e.returnOpenTime || e.openTime || '-') %> - <%= toHm(e.returnCloseTime || e.closeTime || '-') %></td>
            <td><%= e.isClosed ? 'Ja' : 'Nein' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p class="empty">Keine Ausnahmen.</p>
  <% } %>
</section>
