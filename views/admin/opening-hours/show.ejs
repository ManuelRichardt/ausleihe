<% pageTitle = 'Öffnungszeit' %>
<%
  const safeHour = (typeof hour !== 'undefined' && hour) ? hour : {};
  const dayLabels = {
    mon: 'Montag',
    tue: 'Dienstag',
    wed: 'Mittwoch',
    thu: 'Donnerstag',
    fri: 'Freitag',
    sat: 'Samstag',
    sun: 'Sonntag',
  };
  const toHm = (typeof formatTimeHHMM === 'function')
    ? formatTimeHHMM
    : function (value) {
        if (!value) return '';
        const match = String(value).match(/^(\d{1,2}):(\d{2})/);
        if (!match) return String(value);
        return String(Number(match[1])).padStart(2, '0') + ':' + match[2];
      };
%>

<section class="admin opening-hours">
  <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1"><%= dayLabels[safeHour.dayOfWeek] || safeHour.dayOfWeek || 'Öffnungszeit' %></h1>
      <p class="text-muted mb-0">Öffnungszeiten der Ausleihe</p>
    </div>
    <div class="d-flex gap-2">
      <a href="/admin/opening-hours" class="btn btn-outline-secondary">Zur Übersicht</a>
      <a href="/admin/opening-hours/<%= safeHour.id %>/edit" class="btn btn-primary">Bearbeiten</a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <dl class="row mb-0">
        <dt class="col-sm-3">Wochentag</dt>
        <dd class="col-sm-9"><%= dayLabels[safeHour.dayOfWeek] || safeHour.dayOfWeek || '-' %></dd>
        <dt class="col-sm-3">Typ</dt>
        <dd class="col-sm-9"><%= safeHour.isSpecial ? 'Sonderzeit' : 'Regulär' %></dd>
        <dt class="col-sm-3">Öffnet</dt>
        <dd class="col-sm-9"><%= toHm(safeHour.openTime || '-') %></dd>
        <dt class="col-sm-3">Schließt</dt>
        <dd class="col-sm-9"><%= toHm(safeHour.closeTime || '-') %></dd>
        <dt class="col-sm-3">Abholung</dt>
        <dd class="col-sm-9"><%= toHm(safeHour.pickupOpenTime || safeHour.openTime || '-') %> - <%= toHm(safeHour.pickupCloseTime || safeHour.closeTime || '-') %></dd>
        <dt class="col-sm-3">Rückgabe</dt>
        <dd class="col-sm-9"><%= toHm(safeHour.returnOpenTime || safeHour.openTime || '-') %> - <%= toHm(safeHour.returnCloseTime || safeHour.closeTime || '-') %></dd>
        <dt class="col-sm-3">Gültig von</dt>
        <dd class="col-sm-9"><%= safeHour.validFrom || '-' %></dd>
        <dt class="col-sm-3">Gültig bis</dt>
        <dd class="col-sm-9"><%= safeHour.validTo || '-' %></dd>
        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">
          <% if (safeHour.isClosed) { %>
            <span class="badge text-bg-danger">Geschlossen</span>
          <% } else { %>
            <span class="badge text-bg-success">Offen</span>
          <% } %>
        </dd>
      </dl>
    </div>
    <div class="card-footer d-flex justify-content-end">
      <form method="post" action="/admin/opening-hours/<%= safeHour.id %>/delete">
        <input type="hidden" name="csrfToken" value="<%= csrfToken || '' %>">
        <button type="submit" class="btn btn-outline-danger">Löschen</button>
      </form>
    </div>
  </div>
</section>
